(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[630],{30070:(e,s,t)=>{"use strict";t.d(s,{C5:()=>v,MJ:()=>p,Rr:()=>j,eI:()=>f,lR:()=>h,lV:()=>d,zB:()=>u});var a=t(95155),l=t(12115),r=t(99708),n=t(62177),i=t(53999),o=t(82714);let d=n.Op,c=l.createContext({}),u=e=>{let{...s}=e;return(0,a.jsx)(c.Provider,{value:{name:s.name},children:(0,a.jsx)(n.xI,{...s})})},x=()=>{let e=l.useContext(c),s=l.useContext(m),{getFieldState:t}=(0,n.xW)(),a=(0,n.lN)({name:e.name}),r=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=s;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...r}},m=l.createContext({});function f(e){let{className:s,...t}=e,r=l.useId();return(0,a.jsx)(m.Provider,{value:{id:r},children:(0,a.jsx)("div",{"data-slot":"form-item",className:(0,i.cn)("grid gap-2",s),...t})})}function h(e){let{className:s,...t}=e,{error:l,formItemId:r}=x();return(0,a.jsx)(o.J,{"data-slot":"form-label","data-error":!!l,className:(0,i.cn)("data-[error=true]:text-destructive",s),htmlFor:r,...t})}function p(e){let{...s}=e,{error:t,formItemId:l,formDescriptionId:n,formMessageId:i}=x();return(0,a.jsx)(r.DX,{"data-slot":"form-control",id:l,"aria-describedby":t?"".concat(n," ").concat(i):"".concat(n),"aria-invalid":!!t,...s})}function j(e){let{className:s,...t}=e,{formDescriptionId:l}=x();return(0,a.jsx)("p",{"data-slot":"form-description",id:l,className:(0,i.cn)("text-muted-foreground text-sm",s),...t})}function v(e){var s;let{className:t,...l}=e,{error:r,formMessageId:n}=x(),o=r?String(null!=(s=null==r?void 0:r.message)?s:""):l.children;return o?(0,a.jsx)("p",{"data-slot":"form-message",id:n,className:(0,i.cn)("text-destructive text-sm",t),...l,children:o}):null}},33963:(e,s,t)=>{Promise.resolve().then(t.bind(t,59980))},59980:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>E});var a=t(95155),l=t(12115),r=t(16453),n=t(4648),i=t(29869),o=t(56671),d=t(35321),c=t(24232),u=t(55702),x=t(62525),m=t(88482),f=t(53999),h=t(4320),p=t(88145),j=t(37777),v=t(97168),g=t(31886),b=t(27450),N=t(71153),w=t(62177),y=t(48778),z=t(23291),C=t(41085),k=t(30070),_=t(95784),I=t(89852);let A=N.z.object({displayName:N.z.string().nonempty("存档名称不得为空"),defaultGameMode:N.z.enum(Object.values(z.U))});function F(e){let{save:s,children:t,asChild:l}=e,r=(0,w.mN)({resolver:(0,y.u)(A),values:{displayName:s.displayName,defaultGameMode:s.defaultGameMode}}),n=async e=>{try{await (0,g.ow)("/api/saves/".concat(s.name),e),window.location.reload()}catch(e){o.oR.error("无法保存存档信息",{description:e.message})}};return(0,a.jsxs)(C.cj,{children:[(0,a.jsx)(C.CG,{asChild:l,children:t}),(0,a.jsx)(C.h,{children:(0,a.jsx)(k.lV,{...r,children:(0,a.jsxs)("form",{className:"flex-1 flex flex-col",onSubmit:r.handleSubmit(n),children:[(0,a.jsxs)(C.Fm,{children:[(0,a.jsx)(C.qp,{children:"编辑存档"}),(0,a.jsx)(C.Qs,{children:"在此编辑该存档的信息。"})]}),(0,a.jsxs)("div",{className:"flex-1 px-4 flex flex-col gap-5",children:[(0,a.jsx)(k.zB,{control:r.control,name:"displayName",render:e=>{let{field:s}=e;return(0,a.jsxs)(k.eI,{children:[(0,a.jsx)(k.lR,{children:"存档名称"}),(0,a.jsx)(h.Z,{className:"text-center [&_*]:wrap-anywhere",children:s.value}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(k.MJ,{children:(0,a.jsx)(I.p,{...s,placeholder:"请输入存档名称...",autoFocus:!0,autoComplete:"off"})}),(0,a.jsx)(v.$,{variant:"outline",size:"icon",className:"cursor-pointer",onClick:()=>r.setValue("displayName",s.value+"\xa7"),children:"\xa7"})]}),(0,a.jsx)(k.C5,{})]})}}),(0,a.jsx)(k.zB,{control:r.control,name:"defaultGameMode",render:e=>{let{field:s}=e;return(0,a.jsxs)(k.eI,{children:[(0,a.jsx)(k.lR,{children:"默认游戏模式"}),(0,a.jsx)(k.MJ,{children:(0,a.jsxs)(_.l6,{...s,onValueChange:s.onChange,children:[(0,a.jsx)(_.bq,{className:"w-full",children:(0,a.jsx)(_.yv,{})}),(0,a.jsxs)(_.gC,{children:[(0,a.jsx)(_.eb,{value:"adventure",children:"冒险"}),(0,a.jsx)(_.eb,{value:"survival",children:"生存"}),(0,a.jsx)(_.eb,{value:"creative",children:"创造"}),(0,a.jsx)(_.eb,{value:"spectator",children:"旁观"})]})]})}),(0,a.jsx)(k.C5,{})]})}})]}),(0,a.jsxs)(C.XW,{children:[(0,a.jsx)(v.$,{type:"submit",className:"cursor-pointer",children:"确定"}),(0,a.jsx)(C.kN,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"outline",className:"cursor-pointer",children:"取消"})})]})]})})})]})}function M(e){let{save:s,className:t}=e,{name:l,displayName:r,path:n,isCurrent:i,defaultGameMode:d}=s,c=async()=>{try{await (0,g.nl)("/api/saves/".concat(l)),window.location.reload()}catch(e){o.oR.success("无法删除存档 ".concat(l),{description:e.message})}};return(0,a.jsxs)(m.Zp,{className:(0,f.cn)("rounded-md min-h-fit px-3 py-3 flex flex-col justify-between",t),children:[(0,a.jsxs)(j.m_,{children:[(0,a.jsx)(j.k$,{asChild:!0,children:(0,a.jsxs)("div",{className:"flex justify-between px-1",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)(h.Z,{children:r}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:l})]}),i&&(0,a.jsxs)(p.E,{variant:"outline",className:"h-fit",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-600"}),"当前存档"]})]})}),(0,a.jsx)(j.ZI,{children:n})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm pl-1",children:(0,f.Cq)(d)}),(0,a.jsxs)("div",{className:"[&_button]:cursor-pointer",children:[(0,a.jsx)(F,{save:s,asChild:!0,children:(0,a.jsx)(v.$,{variant:"ghost",size:"icon",title:"编辑存档",children:(0,a.jsx)(u.A,{})})}),(0,a.jsx)(b.F,{title:'确定要删除存档 "'.concat(l,'" 吗？'),description:"此操作不可逆，被删除的存档将无法恢复。",onAction:()=>c(),asChild:!0,children:(0,a.jsx)(v.$,{variant:"ghost",size:"icon",disabled:i,title:"删除存档",children:(0,a.jsx)(x.A,{})})})]})]})]})}var D=t(55863);function R(e){let{className:s,value:t,...l}=e;return(0,a.jsx)(D.bL,{"data-slot":"progress",className:(0,f.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...l,children:(0,a.jsx)(D.C1,{"data-slot":"progress-indicator",className:"bg-green-700 dark:bg-green-600 h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(t||0),"%)")}})})}function E(){let[e,s]=(0,l.useState)([]),[t,u]=(0,l.useState)(!1),[x,m]=(0,l.useState)(null),[h,p]=(0,l.useState)(null),j=async()=>{try{let e=(await (0,g.qV)("/api/saves")).saves;for(let s=0;s<e.length;s++)if(e[s].isCurrent&&s>0){let t=e[s-1];e[s-1]=e[s],e[s]=t}s(e)}catch(e){o.oR.error("无法获取存档列表",{description:e.message})}},v=async e=>{e.preventDefault(),u(!1);let s=e.dataTransfer.files[0];if(!s.name.endsWith(".zip"))return void o.oR.error("无法上传存档",{description:"存档格式不正确，请上传一个zip文件"});m(s.name),await (0,d.upload)(g.y0+"/api/saves",{file:s},{headers:{"X-Credential-Token":(0,r.getCookie)("token")},onProgress:e=>{p(e<1?e:null)}}),window.location.reload()};return(0,l.useEffect)(()=>{j()},[]),(0,a.jsxs)(c.C,{title:"存档",icon:(0,a.jsx)(n.A,{}),className:"relative h-full z-20",onDragEnter:()=>u(!0),children:[(0,a.jsxs)("div",{className:(0,f.cn)("absolute top-0 left-0 right-0 bottom-16 flex flex-col justify-center items-center gap-4",t?"":"hidden"),children:[(0,a.jsx)("div",{className:"absolute w-full h-full border-4 rounded-sm border-dashed",onDrop:e=>v(e),onDragOver:e=>e.preventDefault(),onDragLeave:()=>u(!1)}),(0,a.jsx)(i.A,{size:60,stroke:"var(--color-muted-foreground)"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"将地图文件拖拽至此处以上传"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"将地图文件 (zip格式) 拖入页面以进行导入。"}),(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"所有存档"})]}),h&&(0,a.jsxs)("div",{className:"w-72 flex flex-col justify-end items-end gap-2",children:[(0,a.jsxs)("span",{children:["正在上传 ",x,"..."]}),(0,a.jsx)(R,{value:100*h,className:"h-1"})]})]}),(0,a.jsx)("div",{className:"pt-2 grid grid-cols-3 gap-4",children:e.map((e,s)=>(0,a.jsx)(M,{save:e},s))})]})]})}},82714:(e,s,t)=>{"use strict";t.d(s,{J:()=>n});var a=t(95155);t(12115);var l=t(40968),r=t(53999);function n(e){let{className:s,...t}=e;return(0,a.jsx)(l.b,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}},95784:(e,s,t)=>{"use strict";t.d(s,{bq:()=>u,eb:()=>m,gC:()=>x,l6:()=>d,yv:()=>c});var a=t(95155);t(12115);var l=t(14582),r=t(66474),n=t(5196),i=t(47863),o=t(53999);function d(e){let{...s}=e;return(0,a.jsx)(l.bL,{"data-slot":"select",...s})}function c(e){let{...s}=e;return(0,a.jsx)(l.WT,{"data-slot":"select-value",...s})}function u(e){let{className:s,size:t="default",children:n,...i}=e;return(0,a.jsxs)(l.l9,{"data-slot":"select-trigger","data-size":t,className:(0,o.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...i,children:[n,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(r.A,{className:"size-4 opacity-50"})})]})}function x(e){let{className:s,children:t,position:r="popper",...n}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{"data-slot":"select-content",className:(0,o.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[(0,a.jsx)(f,{}),(0,a.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,a.jsx)(h,{})]})})}function m(e){let{className:s,children:t,...r}=e;return(0,a.jsxs)(l.q7,{"data-slot":"select-item",className:(0,o.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(n.A,{className:"size-4"})})}),(0,a.jsx)(l.p4,{children:t})]})}function f(e){let{className:s,...t}=e;return(0,a.jsx)(l.PP,{"data-slot":"select-scroll-up-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(i.A,{className:"size-4"})})}function h(e){let{className:s,...t}=e;return(0,a.jsx)(l.wn,{"data-slot":"select-scroll-down-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(r.A,{className:"size-4"})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[399,613,455,702,370,671,464,371,299,19,193,178,441,684,358],()=>s(33963)),_N_E=e.O()}]);